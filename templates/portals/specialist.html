{% extends "base.html" %}

{% block title %}Specialist Portal - Sapyyn{% endblock %}

{% block content %}
<!-- Specialist Portal Header -->
<div class="bg-gradient-success text-white py-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-5 fw-bold mb-2">
                    <i class="bi bi-mortarboard me-3"></i>
                    Specialist Portal
                </h1>
                <p class="lead mb-0">Welcome back, {{ session.full_name }}!</p>
                {% if session.four_digit_code %}
                <p class="mb-0">Your Referral Code: <strong class="badge bg-light text-dark fs-6">{{ session.four_digit_code }}</strong></p>
                {% endif %}
                {% if session.specialty %}
                <p class="mb-0">Specialty: <span class="badge bg-warning text-dark">{{ session.specialty|title }}</span></p>
                {% endif %}
            </div>
            <div class="col-lg-4 text-end">
                <div class="card bg-white text-dark">
                    <div class="card-body p-3">
                        <h5 class="mb-1">Today's Overview</h5>
                        <div class="row text-center">
                            <div class="col-4">
                                <h4 class="text-primary mb-0">5</h4>
                                <small>New Referrals</small>
                            </div>
                            <div class="col-4">
                                <h4 class="text-warning mb-0">3</h4>
                                <small>Pending</small>
                            </div>
                            <div class="col-4">
                                <h4 class="text-success mb-0">7</h4>
                                <small>Completed</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="py-4 bg-light">
    <div class="container">
        <div class="row g-3">
            <div class="col-lg-3 col-md-6">
                <a href="#" class="card text-decoration-none h-100 border-0 shadow-sm" onclick="viewReferrals('new')">
                    <div class="card-body text-center p-4">
                        <i class="bi bi-inbox-fill text-primary fs-1 mb-3"></i>
                        <h5 class="fw-bold text-dark">New Referrals</h5>
                        <p class="text-muted mb-0">Review incoming referrals</p>
                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a href="#" class="card text-decoration-none h-100 border-0 shadow-sm" onclick="viewSchedule()">
                    <div class="card-body text-center p-4">
                        <i class="bi bi-calendar-event text-success fs-1 mb-3"></i>
                        <h5 class="fw-bold text-dark">Schedule</h5>
                        <p class="text-muted mb-0">Manage appointments</p>
                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a href="{{ url_for('view_documents') }}" class="card text-decoration-none h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <i class="bi bi-file-earmark-medical text-warning fs-1 mb-3"></i>
                        <h5 class="fw-bold text-dark">Patient Files</h5>
                        <p class="text-muted mb-0">Access patient records</p>
                    </div>
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a href="{{ url_for('rewards') }}" class="card text-decoration-none h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <i class="bi bi-trophy-fill text-info fs-1 mb-3"></i>
                        <h5 class="fw-bold text-dark">Rewards</h5>
                        <p class="text-muted mb-0">View earned points</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Main Dashboard -->
<div class="py-5">
    <div class="container">
        <div class="row g-4">
            <!-- Referral Queue -->
            <div class="col-lg-8">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-list-ul me-2"></i>
                            Referral Queue
                        </h5>
                        <div class="btn-group btn-group-sm" role="group">
                            <input type="radio" class="btn-check" name="queueFilter" id="all" autocomplete="off" checked>
                            <label class="btn btn-outline-light" for="all">All</label>
                            
                            <input type="radio" class="btn-check" name="queueFilter" id="new" autocomplete="off">
                            <label class="btn btn-outline-light" for="new">New</label>
                            
                            <input type="radio" class="btn-check" name="queueFilter" id="urgent" autocomplete="off">
                            <label class="btn btn-outline-light" for="urgent">Urgent</label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Patient</th>
                                        <th>Referring Doctor</th>
                                        <th>Condition</th>
                                        <th>Urgency</th>
                                        <th>Received</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="referralQueue">
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                                                    <i class="bi bi-person text-primary"></i>
                                                </div>
                                                <div>
                                                    <strong>Emma Thompson</strong><br>
                                                    <small class="text-muted">emma.t@email.com</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>Dr. Smith<br><small class="text-muted">Family Dental</small></td>
                                        <td>Orthodontic evaluation</td>
                                        <td><span class="badge bg-warning">Normal</span></td>
                                        <td>2 hours ago</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-primary" onclick="viewReferral(1)">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                                <button class="btn btn-success" onclick="acceptReferral(1)">
                                                    <i class="bi bi-check"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="bg-danger bg-opacity-10 rounded-circle p-2 me-2">
                                                    <i class="bi bi-exclamation-triangle text-danger"></i>
                                                </div>
                                                <div>
                                                    <strong>Robert Johnson</strong><br>
                                                    <small class="text-muted">r.johnson@email.com</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>Dr. Brown<br><small class="text-muted">Smile Clinic</small></td>
                                        <td>Emergency extraction</td>
                                        <td><span class="badge bg-danger">Urgent</span></td>
                                        <td>1 hour ago</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-primary" onclick="viewReferral(2)">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                                <button class="btn btn-success" onclick="acceptReferral(2)">
                                                    <i class="bi bi-check"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="bg-success bg-opacity-10 rounded-circle p-2 me-2">
                                                    <i class="bi bi-person text-success"></i>
                                                </div>
                                                <div>
                                                    <strong>Lisa Davis</strong><br>
                                                    <small class="text-muted">l.davis@email.com</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>Dr. Wilson<br><small class="text-muted">Dental Care Plus</small></td>
                                        <td>Routine cleaning</td>
                                        <td><span class="badge bg-success">Low</span></td>
                                        <td>4 hours ago</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-primary" onclick="viewReferral(3)">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                                <button class="btn btn-success" onclick="acceptReferral(3)">
                                                    <i class="bi bi-check"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Today's Schedule -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0">
                            <i class="bi bi-calendar-day me-2"></i>
                            Today's Schedule
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            <div class="d-flex mb-3">
                                <div class="bg-primary rounded p-2 me-3 text-white text-center" style="min-width: 60px;">
                                    <small>9:00</small>
                                </div>
                                <div>
                                    <strong>John Smith</strong><br>
                                    <small class="text-muted">Consultation</small>
                                </div>
                            </div>
                            <div class="d-flex mb-3">
                                <div class="bg-warning rounded p-2 me-3 text-white text-center" style="min-width: 60px;">
                                    <small>10:30</small>
                                </div>
                                <div>
                                    <strong>Sarah Wilson</strong><br>
                                    <small class="text-muted">Follow-up</small>
                                </div>
                            </div>
                            <div class="d-flex mb-3">
                                <div class="bg-info rounded p-2 me-3 text-white text-center" style="min-width: 60px;">
                                    <small>2:00</small>
                                </div>
                                <div>
                                    <strong>Mike Brown</strong><br>
                                    <small class="text-muted">Treatment</small>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-outline-success btn-sm">
                                View Full Schedule
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Metrics -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0">
                            <i class="bi bi-graph-up me-2"></i>
                            This Month
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 border-end">
                                <h4 class="text-primary mb-0">24</h4>
                                <small class="text-muted">Referrals</small>
                            </div>
                            <div class="col-6">
                                <h4 class="text-success mb-0">18</h4>
                                <small class="text-muted">Completed</small>
                            </div>
                        </div>
                        <hr>
                        <div class="row text-center">
                            <div class="col-6 border-end">
                                <h4 class="text-warning mb-0">320</h4>
                                <small class="text-muted">Points</small>
                            </div>
                            <div class="col-6">
                                <h4 class="text-info mb-0">4.8</h4>
                                <small class="text-muted">Rating</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Notes -->
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-warning text-white">
                        <h6 class="mb-0">
                            <i class="bi bi-sticky me-2"></i>
                            Quick Notes
                        </h6>
                    </div>
                    <div class="card-body">
                        <textarea class="form-control border-0" rows="4" placeholder="Add a quick note..."></textarea>
                        <div class="mt-2">
                            <button class="btn btn-warning btn-sm">Save Note</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Referral Detail Modal -->
<div class="modal fade" id="referralModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Referral Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="referralDetails">
                    <!-- Details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger">Decline</button>
                <button type="button" class="btn btn-success">Accept Referral</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function viewReferral(id) {
    // Load referral details and show modal
    const modal = new bootstrap.Modal(document.getElementById('referralModal'));
    
    // This would typically fetch data from the server
    document.getElementById('referralDetails').innerHTML = `
        <div class="row">
            <div class="col-md-6">
                <h6>Patient Information</h6>
                <p><strong>Name:</strong> Emma Thompson</p>
                <p><strong>Age:</strong> 32</p>
                <p><strong>Phone:</strong> (555) 123-4567</p>
                <p><strong>Email:</strong> emma.t@email.com</p>
            </div>
            <div class="col-md-6">
                <h6>Referral Details</h6>
                <p><strong>Condition:</strong> Orthodontic evaluation</p>
                <p><strong>Urgency:</strong> Normal</p>
                <p><strong>Referring Doctor:</strong> Dr. Smith</p>
                <p><strong>Practice:</strong> Family Dental</p>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-12">
                <h6>Medical History</h6>
                <p>Patient reports mild crowding of lower teeth. No previous orthodontic treatment. No known allergies.</p>
            </div>
        </div>
    `;
    
    modal.show();
}

function acceptReferral(id) {
    if (confirm('Accept this referral and schedule an appointment?')) {
        // This would typically send a request to the server
        alert('Referral accepted! Patient will be notified.');
        location.reload();
    }
}

function viewReferrals(filter) {
    // Filter referrals based on status
    console.log('Filtering referrals by:', filter);
}

function viewSchedule() {
    // Navigate to schedule view
    alert('Opening schedule view...');
}

// Auto-refresh referral queue every 60 seconds
setInterval(function() {
    console.log('Refreshing referral queue...');
    // This would typically fetch updated data from the server
}, 60000);

// Notification sound for new referrals
function playNotificationSound() {
    // Create audio element and play notification sound
    const audio = new Audio('/static/sounds/notification.mp3');
    audio.play().catch(e => console.log('Audio play failed:', e));
}

// Simulate new referral notification
setTimeout(() => {
    // This would be triggered by server-sent events or websockets in a real app
    console.log('New referral received!');
    playNotificationSound();
}, 5000);
</script>
{% endblock %}