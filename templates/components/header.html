<!-- Enhanced Header Navigation Component -->
<nav class="navbar navbar-expand-lg navbar-dark shadow-sm" id="mainNavbar">
    <div class="container">
        <!-- Single Clean Logo -->
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
            <img src="{{ url_for('static', filename='images/sapyyn-logo.svg') }}" 
                 alt="Sapyyn - Patient Referral System" 
                 class="navbar-logo"
                 style="height: 42px; width: auto;">
        </a>
        
        <!-- Mobile Toggle Button -->
        <button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                aria-label="Toggle navigation menu" aria-controls="navbarNav" aria-expanded="false">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <!-- Navigation Content -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                {% if session.user_id %}
                    <!-- Authenticated Navigation -->
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('dashboard') }}" title="Dashboard">
                            <i class="bi bi-speedometer2 me-1"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('new_referral') }}" title="Create New Referral">
                            <i class="bi bi-plus-circle me-1"></i> New Referral
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('my_referrals') }}" title="View My Referrals">
                            <i class="bi bi-people me-1"></i> My Referrals
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('portal_appointments') }}" title="Manage Appointments">
                            <i class="bi bi-calendar-check me-1"></i> Appointments
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('rewards_dashboard') }}" title="Rewards & Incentives">
                            <i class="bi bi-trophy me-1"></i> Rewards
                        </a>
                    </li>
                {% else %}
                    <!-- Public Navigation -->
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" 
                           href="{{ url_for('index') }}" title="Home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'pricing' %}active{% endif %}" 
                           href="{{ url_for('pricing') }}" title="Pricing Plans">Pricing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'about' %}active{% endif %}" 
                           href="{{ url_for('about') }}" title="About Sapyyn">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'contact' %}active{% endif %}" 
                           href="{{ url_for('contact') }}" title="Contact Us">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'surgical_instruction' %}active{% endif %}" 
                           href="{{ url_for('surgical_instruction') }}" title="Surgical Instructions">
                            Surgical Instructions
                        </a>
                    </li>
                {% endif %}
            </ul>
            
            <ul class="navbar-nav">
                {% if session.user_id %}
                    <!-- User Profile Dropdown -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-bs-toggle="dropdown" 
                           title="User Menu">
                            <i class="bi bi-person-circle me-1"></i>
                            <span class="d-none d-md-inline">{{ session.full_name or session.username }}</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-lg">
                            <li><a class="dropdown-item" href="{{ url_for('profile') }}">
                                <i class="bi bi-person me-2"></i>Profile
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('settings') }}">
                                <i class="bi bi-gear me-2"></i>Settings
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                {% else %}
                    <!-- Public CTAs -->
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('login') }}" title="Sign In">
                            <i class="bi bi-box-arrow-in-right me-1"></i>Sign In
                        </a>
                    </li>
                    <li class="nav-item ms-lg-2">
                        <a class="btn btn-warning btn-sm px-3 py-2 fw-semibold shadow-sm" 
                           href="{{ url_for('get_started_page') }}" title="Start Free Trial">
                            <i class="bi bi-rocket-takeoff me-1"></i>Get Started
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<!-- Enhanced CSS for Professional Header -->
<style>
/* Enhanced Header Styling */
.navbar {
    padding: 1rem 0;
    background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%) !important;
    box-shadow: 0 2px 20px rgba(13, 110, 253, 0.15);
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
}

.navbar-brand {
    font-size: 1.75rem;
    font-weight: 700;
    color: white !important;
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
}

.navbar-brand:hover {
    transform: translateY(-1px);
    filter: brightness(1.1);
}

.navbar-logo {
    height: 42px;
    width: auto;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    transition: all 0.3s ease;
}

.navbar-logo:hover {
    transform: scale(1.05);
}

/* Navigation Links */
.navbar-nav .nav-link {
    color: rgba(255, 255, 255, 0.9) !important;
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.75rem 1rem;
    transition: all 0.3s ease;
    border-radius: 0.5rem;
    margin: 0 0.125rem;
    position: relative;
    display: flex;
    align-items: center;
}

.navbar-nav .nav-link:hover {
    color: white !important;
    background-color: rgba(255, 255, 255, 0.15);
    transform: translateY(-1px);
}

.navbar-nav .nav-link.active {
    color: white !important;
    background-color: rgba(255, 255, 255, 0.25);
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
}

.navbar-nav .nav-link.active::before {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 2px;
    background-color: #ffc107;
    border-radius: 1px;
}

/* Icons in Navigation */
.navbar-nav .nav-link i {
    font-size: 1rem;
    margin-right: 0.25rem;
}

/* Dropdown Styling */
.dropdown-menu {
    border: none;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    border-radius: 0.75rem;
    margin-top: 0.5rem;
    background: white;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
}

.dropdown-item {
    padding: 0.75rem 1.25rem;
    font-size: 0.9rem;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
    transform: translateX(2px);
}

.dropdown-item i {
    font-size: 1rem;
    width: 1.25rem;
}

/* CTA Buttons */
.btn-warning {
    background: linear-gradient(135deg, #ffc107 0%, #ffca2c 100%);
    border: none;
    color: #000;
    font-weight: 600;
    font-size: 0.9rem;
    padding: 0.625rem 1.25rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
}

.btn-warning:hover {
    background: linear-gradient(135deg, #ffca2c 0%, #ffd454 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(255, 193, 7, 0.4);
}

/* Mobile Responsive */
@media (max-width: 991.98px) {
    .navbar {
        padding: 0.75rem 0;
    }
    
    .navbar-brand {
        font-size: 1.5rem;
    }
    
    .navbar-logo {
        height: 36px;
    }
    
    .navbar-nav {
        margin-top: 1rem;
        padding: 0.5rem 0;
    }
    
    .navbar-nav .nav-link {
        padding: 0.875rem 1rem;
        margin: 0.125rem 0;
        font-size: 1rem;
    }
    
    .navbar-nav .nav-link i {
        margin-right: 0.5rem;
    }
    
    .dropdown-menu {
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .btn-warning {
        margin: 0.5rem 0;
        width: 100%;
        text-align: center;
    }
}

@media (max-width: 575.98px) {
    .navbar {
        padding: 0.5rem 0;
    }
    
    .navbar-brand {
        font-size: 1.25rem;
    }
    
    .navbar-logo {
        height: 32px;
    }
}

/* Toggler Enhancement */
.navbar-toggler {
    border: none;
    padding: 0.5rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
}

.navbar-toggler:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.navbar-toggler:focus {
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.25);
}

/* Smooth Transitions */
* {
    transition: all 0.2s ease;
}

/* Accessibility Improvements */
@media (prefers-reduced-motion: reduce) {
    * {
        transition: none !important;
    }
}

/* Focus States */
.navbar-nav .nav-link:focus,
.btn-warning:focus,
.dropdown-toggle:focus {
    outline: 2px solid #ffc107;
    outline-offset: 2px;
}
</style>

<!-- JavaScript for Active State Management -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add active class based on current route
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
    
    navLinks.forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            link.classList.add('active');
        }
    });
    
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
