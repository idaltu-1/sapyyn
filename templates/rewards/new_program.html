{% extends "base.html" %}

{% block title %}New Reward Program - Sapyyn{% endblock %}

{% block extra_head %}
<style>
    .form-section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 20px;
    }
    .compliance-section {
        background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
    }
    .legal-section {
        background: linear-gradient(135deg, #a8e6cf 0%, #88d8c0 100%);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Header -->
            <div class="text-center mb-4">
                <h1 class="h2">
                    <i class="bi bi-plus-circle text-primary"></i>
                    Create New Reward Program
                </h1>
                <p class="text-muted">Design a comprehensive reward program with HIPAA and Stark compliance</p>
            </div>

            <!-- Form -->
            <form method="POST" class="needs-validation" novalidate>
                <!-- Basic Information -->
                <div class="form-section">
                    <h4 class="mb-4">
                        <i class="bi bi-info-circle"></i>
                        Basic Information
                    </h4>
                    
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <label for="name" class="form-label">Program Name *</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                            <div class="invalid-feedback">
                                Please provide a program name.
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="program_type" class="form-label">Program Type *</label>
                            <select class="form-select" id="program_type" name="program_type" required>
                                <option value="">Choose...</option>
                                <option value="referral">Referral Rewards</option>
                                <option value="loyalty">Loyalty Program</option>
                                <option value="achievement">Achievement Based</option>
                                <option value="milestone">Milestone Rewards</option>
                            </select>
                            <div class="invalid-feedback">
                                Please select a program type.
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Program Description *</label>
                        <textarea class="form-control" id="description" name="description" rows="4" required
                                  placeholder="Describe the purpose, goals, and benefits of this reward program..."></textarea>
                        <div class="invalid-feedback">
                            Please provide a program description.
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="start_date" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="start_date" name="start_date">
                        </div>
                        <div class="col-md-6">
                            <label for="end_date" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="end_date" name="end_date">
                            <div class="form-text">Leave blank for ongoing programs</div>
                        </div>
                    </div>
                </div>

                <!-- Compliance Section -->
                <div class="compliance-section">
                    <h4 class="mb-4">
                        <i class="bi bi-shield-check"></i>
                        HIPAA & Stark Law Compliance
                    </h4>
                    
                    <div class="alert alert-warning mb-4">
                        <strong>Important:</strong> All reward programs must comply with healthcare regulations including HIPAA privacy rules and Stark Law anti-kickback provisions.
                    </div>

                    <div class="mb-3">
                        <label for="compliance_notes" class="form-label">Compliance Assessment *</label>
                        <textarea class="form-control" id="compliance_notes" name="compliance_notes" rows="4" required
                                  placeholder="Document how this program complies with HIPAA, Stark Law, and other healthcare regulations. Include any legal reviews or approvals obtained..."></textarea>
                        <div class="invalid-feedback">
                            Compliance documentation is required.
                        </div>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="hipaa_compliance" required>
                        <label class="form-check-label" for="hipaa_compliance">
                            I confirm this program has been reviewed for HIPAA compliance
                        </label>
                        <div class="invalid-feedback">
                            HIPAA compliance confirmation is required.
                        </div>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="stark_compliance" required>
                        <label class="form-check-label" for="stark_compliance">
                            I confirm this program has been reviewed for Stark Law compliance
                        </label>
                        <div class="invalid-feedback">
                            Stark Law compliance confirmation is required.
                        </div>
                    </div>
                </div>

                <!-- Legal Language -->
                <div class="legal-section">
                    <h4 class="mb-4">
                        <i class="bi bi-file-text"></i>
                        Legal Terms & Conditions
                    </h4>
                    
                    <div class="mb-3">
                        <label for="legal_language" class="form-label">Program Terms & Conditions *</label>
                        <textarea class="form-control" id="legal_language" name="legal_language" rows="6" required>This referral reward program is designed to recognize and appreciate healthcare professionals who make appropriate patient referrals. 

COMPLIANCE NOTICE:
- This program complies with all applicable healthcare regulations including HIPAA and Stark Law
- Rewards are provided for appropriate referrals only, not for volume or value of services
- All participant information is maintained in strict confidence
- Participants must comply with all professional and ethical standards

ELIGIBILITY:
- Licensed healthcare professionals only
- Referrals must be medically appropriate and in patient's best interest
- No rewards for self-referrals or inappropriate referrals

PRIVACY:
- All personal and professional information protected under HIPAA
- Anonymized data may be used for program analytics
- Participants may opt-out at any time

By participating, you acknowledge understanding and agreement to these terms.</textarea>
                        <div class="invalid-feedback">
                            Legal terms and conditions are required.
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a href="{{ url_for('rewards_admin') }}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Create Program
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Bootstrap form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>
{% endblock %}
