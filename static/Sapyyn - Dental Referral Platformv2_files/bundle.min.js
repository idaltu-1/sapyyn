!function(){"use strict";const e={formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},formatDate:e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),debounce(e,t){let i;return function(...n){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...n)},t)}},showToast(e,t="info"){const i=document.getElementById("toastContainer")||this.createToastContainer(),n=document.createElement("div");n.className=`toast align-items-center text-white bg-${t} border-0`,n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.innerHTML=`\n            <div class="d-flex">\n                <div class="toast-body">\n                    ${e}\n                </div>\n                <button type="button" class="btn-close btn-close-white me-2 m-auto" \n                        data-bs-dismiss="toast" aria-label="Close"></button>\n            </div>\n        `,i.appendChild(n);new bootstrap.Toast(n).show(),n.addEventListener("hidden.bs.toast",()=>{n.remove()})},createToastContainer(){const e=document.createElement("div");return e.id="toastContainer",e.className="toast-container position-fixed bottom-0 end-0 p-3",e.style.zIndex="9999",document.body.appendChild(e),e},showLoading(){if(document.getElementById("loadingOverlay"))return;const e=document.createElement("div");e.id="loadingOverlay",e.className="loading-overlay",e.innerHTML='\n            <div class="text-center">\n                <div class="loading-spinner"></div>\n                <p class="mt-3 text-muted">Loading...</p>\n            </div>\n        ',document.body.appendChild(e)},hideLoading(){const e=document.getElementById("loadingOverlay");e&&e.remove()}},t={init(){this.setupDragAndDrop(),this.setupFileValidation()},setupDragAndDrop(){const e=document.querySelector(".file-upload-area");e&&(["dragenter","dragover","dragleave","drop"].forEach(t=>{e.addEventListener(t,this.preventDefaults,!1),document.body.addEventListener(t,this.preventDefaults,!1)}),["dragenter","dragover"].forEach(t=>{e.addEventListener(t,this.highlight.bind(this),!1)}),["dragleave","drop"].forEach(t=>{e.addEventListener(t,this.unhighlight.bind(this),!1)}),e.addEventListener("drop",this.handleDrop.bind(this),!1))},preventDefaults(e){e.preventDefault(),e.stopPropagation()},highlight(e){e.target.classList.add("dragover")},unhighlight(e){e.target.classList.remove("dragover")},handleDrop(e){const t=e.dataTransfer.files;if(t.length>0){const e=document.getElementById("file");e&&(e.files=t,this.handleFileSelect(t[0]))}},setupFileValidation(){const e=document.getElementById("file");e&&e.addEventListener("change",e=>{e.target.files.length>0&&this.handleFileSelect(e.target.files[0])})},handleFileSelect(t){this.validateFile(t)&&(this.showFilePreview(t),e.showToast(`File "${t.name}" selected successfully`,"success"))},validateFile:t=>t.size>16777216?(e.showToast("File size must be less than 16MB","danger"),!1):!!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","image/png","image/jpeg","image/jpg","image/gif","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(t.type)||(e.showToast("File type not supported","danger"),!1),showFilePreview(t){const i=document.getElementById("filePreview");if(!i)return;const n=i.querySelector("#previewContent");if(!n)return;let a=`\n            <div class="d-flex align-items-center">\n                <div class="me-3">\n                    ${this.getFileIcon(t.type)}\n                </div>\n                <div>\n                    <div class="fw-semibold">${t.name}</div>\n                    <div class="text-muted small">\n                        Size: ${e.formatFileSize(t.size)} | \n                        Type: ${t.type||"Unknown"}\n                    </div>\n                </div>\n            </div>\n        `;if(t.type.startsWith("image/")){const e=new FileReader;e.onload=e=>{a+=`\n                    <div class="mt-3">\n                        <img src="${e.target.result}" alt="Preview" class="img-thumbnail" style="max-height: 200px;">\n                    </div>\n                `,n.innerHTML=a},e.readAsDataURL(t)}else n.innerHTML=a;i.style.display="block"},getFileIcon:e=>e.startsWith("image/")?'<i class="bi bi-file-image text-info fs-1"></i>':{"application/pdf":'<i class="bi bi-file-pdf text-danger fs-1"></i>',"application/msword":'<i class="bi bi-file-word text-primary fs-1"></i>',"application/vnd.openxmlformats-officedocument.wordprocessingml.document":'<i class="bi bi-file-word text-primary fs-1"></i>',"text/plain":'<i class="bi bi-file-text text-secondary fs-1"></i>',"application/vnd.ms-excel":'<i class="bi bi-file-excel text-success fs-1"></i>',"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":'<i class="bi bi-file-excel text-success fs-1"></i>'}[e]||'<i class="bi bi-file-earmark text-muted fs-1"></i>'},i={init(){this.loadStats(),this.setupAutoRefresh()},loadStats(){fetch("/api/stats").then(e=>e.json()).then(e=>{this.updateStatCards(e),this.updateCharts(e)}).catch(t=>{e.showToast("Failed to load dashboard statistics","danger")})},updateStatCards(e){const t=document.getElementById("pendingCount"),i=document.getElementById("approvedCount");t&&(t.textContent=e.status_counts?.pending||0),i&&(i.textContent=e.status_counts?.approved||0)},updateCharts(e){},setupAutoRefresh(){setInterval(()=>{this.loadStats()},3e5)}},n={init(){this.setupDocumentSearch(),this.setupReferralSearch()},setupDocumentSearch(){const t=document.getElementById("searchDocuments"),i=document.getElementById("filterType");t&&t.addEventListener("input",e.debounce(()=>{this.filterDocuments()},300)),i&&i.addEventListener("change",()=>{this.filterDocuments()})},setupReferralSearch(){const t=document.getElementById("searchReferrals");t&&t.addEventListener("input",e.debounce(()=>{this.filterReferrals()},300))},filterDocuments(){const e=document.getElementById("searchDocuments")?.value.toLowerCase()||"",t=document.getElementById("filterType")?.value||"",i=document.querySelectorAll(".document-item");let n=0;i.forEach(i=>{const a=i.dataset.name||"",s=i.dataset.type||"";(!e||a.includes(e))&&(!t||s===t)?(i.style.display="block",n++):i.style.display="none"}),this.updateResultsCounter(n,i.length)},filterReferrals(){},updateResultsCounter(e,t){let i=document.getElementById("resultsCounter");if(!i){i=document.createElement("div"),i.id="resultsCounter",i.className="text-muted small mt-2";const e=document.getElementById("searchDocuments")?.parentNode;e&&e.appendChild(i)}i.textContent=`Showing ${e} of ${t} documents`}},a={init(){this.setupFormValidation(),this.setupAutoSave()},setupFormValidation(){document.querySelectorAll("form[data-validate]").forEach(e=>{e.addEventListener("submit",t=>{this.validateForm(e)||t.preventDefault()})})},validateForm(e){const t=e.querySelectorAll("[required]");let i=!0;return t.forEach(e=>{e.value.trim()?this.clearFieldError(e):(this.showFieldError(e,"This field is required"),i=!1)}),i},showFieldError(e,t){e.classList.add("is-invalid");let i=e.parentNode.querySelector(".invalid-feedback");i||(i=document.createElement("div"),i.className="invalid-feedback",e.parentNode.appendChild(i)),i.textContent=t},clearFieldError(e){e.classList.remove("is-invalid");const t=e.parentNode.querySelector(".invalid-feedback");t&&t.remove()},setupAutoSave(){document.querySelectorAll("form[data-autosave]").forEach(t=>{t.addEventListener("input",e.debounce(()=>{this.autoSave(t)},2e3))})},autoSave(t){const i=new FormData(t),n=Object.fromEntries(i),a=t.id||"form";localStorage.setItem(`autosave_${a}`,JSON.stringify(n)),e.showToast("Draft saved automatically","info")}},s={generate(e,t){const i=document.getElementById(t);i&&(i.innerHTML='\n                <div class="qr-code-container">\n                    <div class="placeholder bg-light p-4 text-center">\n                        <i class="bi bi-qr-code fs-1 text-muted"></i>\n                        <p class="mt-2 text-muted">QR Code would be generated here</p>\n                    </div>\n                </div>\n            ')},download(e,t="qr-code.png"){const i=document.createElement("a");i.download=t,i.href=`data:image/png;base64,${e}`,i.click()}},o={init(){this.checkPermission(),this.setupServiceWorker()},checkPermission(){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission()},show(t,i={}){"Notification"in window&&"granted"===Notification.permission?new Notification(t,{icon:"/static/images/logo.png",badge:"/static/images/badge.png",...i}):e.showToast(t,"info")},setupServiceWorker(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/static/js/sw.js").then(e=>{}).catch(e=>{})}};document.addEventListener("DOMContentLoaded",function(){t.init(),i.init(),n.init(),a.init(),o.init(),document.addEventListener("show.bs.modal",function(e){}),document.addEventListener("submit",function(t){"FORM"===t.target.tagName&&e.showLoading()}),window.addEventListener("beforeunload",function(e){"true"===localStorage.getItem("hasUnsavedChanges")&&(e.preventDefault(),e.returnValue="")}),function(){const e=document.getElementById("themeToggle");e&&e.addEventListener("click",function(){const e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)});const t=localStorage.getItem("theme");t&&document.documentElement.setAttribute("data-theme",t)}()}),window.SapyynApp={apiUrl:"/api",version:"1.0.0",debug:!0,year:2025},window.Utils=e,window.FileUpload=t,window.Dashboard=i,window.Search=n,window.Forms=a,window.QRCode=s,window.Notifications=o}();
//# sourceMappingURL=bundle.min.js.map
